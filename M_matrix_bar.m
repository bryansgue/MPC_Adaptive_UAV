function [M] = M_matrix_bar(X,q)
%UNTITLED Summary of this function goes here
%   Detailed explanation goes here
phi = q(4);
theta = q(5);
psi = q(6);

m1 = X(1);
Ixx = X(2);
Iyy = X(3);
Izz = X(4);

% M = [                                                                                                                                                                                                                                                                              (m1*cos(psi)*cos(theta))/(cos(psi)^2*cos(theta)^2 + cos(psi)^2*sin(theta)^2 + cos(theta)^2*sin(psi)^2 + sin(psi)^2*sin(theta)^2),                                                                                                                                                                                                                                                                               (m1*cos(theta)*sin(psi))/(cos(psi)^2*cos(theta)^2 + cos(psi)^2*sin(theta)^2 + cos(theta)^2*sin(psi)^2 + sin(psi)^2*sin(theta)^2),                                                                                   -(m1*sin(theta))/(cos(theta)^2 + sin(theta)^2),               0,                                        0,                                                                                                     0;...
%     -(m1*(cos(phi)*cos(theta)^2*sin(psi) + cos(phi)*sin(psi)*sin(theta)^2 - cos(psi)*sin(phi)*sin(theta)))/(cos(phi)^2*cos(psi)^2*sin(theta)^2 + cos(phi)^2*cos(theta)^2*sin(psi)^2 + cos(psi)^2*cos(theta)^2*sin(phi)^2 + cos(phi)^2*sin(psi)^2*sin(theta)^2 + cos(psi)^2*sin(phi)^2*sin(theta)^2 + cos(theta)^2*sin(phi)^2*sin(psi)^2 + sin(phi)^2*sin(psi)^2*sin(theta)^2 + cos(phi)^2*cos(psi)^2*cos(theta)^2),  (m1*(sin(phi)*sin(psi)*sin(theta) + cos(phi)*cos(psi)*cos(theta)^2 + cos(phi)*cos(psi)*sin(theta)^2))/(cos(phi)^2*cos(psi)^2*sin(theta)^2 + cos(phi)^2*cos(theta)^2*sin(psi)^2 + cos(psi)^2*cos(theta)^2*sin(phi)^2 + cos(phi)^2*sin(psi)^2*sin(theta)^2 + cos(psi)^2*sin(phi)^2*sin(theta)^2 + cos(theta)^2*sin(phi)^2*sin(psi)^2 + sin(phi)^2*sin(psi)^2*sin(theta)^2 + cos(phi)^2*cos(psi)^2*cos(theta)^2), (m1*cos(theta)*sin(phi))/(cos(phi)^2*cos(theta)^2 + cos(phi)^2*sin(theta)^2 + cos(theta)^2*sin(phi)^2 + sin(phi)^2*sin(theta)^2),               0,                                        0,                                                                                                     0;...
%     (m1*(cos(theta)^2*sin(phi)*sin(psi) + sin(phi)*sin(psi)*sin(theta)^2 + cos(phi)*cos(psi)*sin(theta)))/(cos(phi)^2*cos(psi)^2*sin(theta)^2 + cos(phi)^2*cos(theta)^2*sin(psi)^2 + cos(psi)^2*cos(theta)^2*sin(phi)^2 + cos(phi)^2*sin(psi)^2*sin(theta)^2 + cos(psi)^2*sin(phi)^2*sin(theta)^2 + cos(theta)^2*sin(phi)^2*sin(psi)^2 + sin(phi)^2*sin(psi)^2*sin(theta)^2 + cos(phi)^2*cos(psi)^2*cos(theta)^2), -(m1*(cos(psi)*cos(theta)^2*sin(phi) + cos(psi)*sin(phi)*sin(theta)^2 - cos(phi)*sin(psi)*sin(theta)))/(cos(phi)^2*cos(psi)^2*sin(theta)^2 + cos(phi)^2*cos(theta)^2*sin(psi)^2 + cos(psi)^2*cos(theta)^2*sin(phi)^2 + cos(phi)^2*sin(psi)^2*sin(theta)^2 + cos(psi)^2*sin(phi)^2*sin(theta)^2 + cos(theta)^2*sin(phi)^2*sin(psi)^2 + sin(phi)^2*sin(psi)^2*sin(theta)^2 + cos(phi)^2*cos(psi)^2*cos(theta)^2), (m1*cos(phi)*cos(theta))/(cos(phi)^2*cos(theta)^2 + cos(phi)^2*sin(theta)^2 + cos(theta)^2*sin(phi)^2 + sin(phi)^2*sin(theta)^2),               0,                                        0,                                                                                                     0;...
%     0,                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                0,             Ixx,                                        0,                                                                                       -Ixx*sin(theta);...
%     0,                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                0,               0,    Izz + Iyy*cos(phi)^2 - Izz*cos(phi)^2,                                                              cos(phi)*cos(theta)*sin(phi)*(Iyy - Izz);...
%     0,                                                                                                                                                                                                                                                                                                                                                                                                              0,                                                                                                                                0, -Ixx*sin(theta), cos(phi)*cos(theta)*sin(phi)*(Iyy - Izz), Ixx - Ixx*cos(theta)^2 + Iyy*cos(theta)^2 - Iyy*cos(phi)^2*cos(theta)^2 + Izz*cos(phi)^2*cos(theta)^2];

M = [ m1,  0,  0,               0,                                                                   0,                                                                                                     0;...
    0, m1,  0,               0,                                                                   0,                                                                                                     0;...
    0,  0, m1,               0,                                                                   0,                                                                                                     0;...
    0,  0,  0,             Ixx,                                                                   0,                                                                                       -Ixx*sin(theta);...
    0,  0,  0,               0,                               Izz + Iyy*cos(phi)^2 - Izz*cos(phi)^2,                                   Iyy*cos(phi)*cos(theta)*sin(phi) - Izz*cos(phi)*cos(theta)*sin(phi);...
    0,  0,  0, -Ixx*sin(theta), Iyy*cos(phi)*cos(theta)*sin(phi) - Izz*cos(phi)*cos(theta)*sin(phi), Ixx - Ixx*cos(theta)^2 + Iyy*cos(theta)^2 - Iyy*cos(phi)^2*cos(theta)^2 + Izz*cos(phi)^2*cos(theta)^2];
 

end

